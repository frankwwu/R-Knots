# Bike Sharing: Conditional Inference Trees

### Data Fields
**datetime** - hourly date + timestamp

**season** -  1 = spring, 2 = summer, 3 = fall, 4 = winter 

**holiday** - whether the day is considered a holiday

**workingday** - whether the day is neither a weekend nor holiday

**weather** - 1: Clear, Few clouds, Partly cloudy, Partly cloudy

2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist 

3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds 

4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog 

**temp** - temperature in Celsius

**atemp** - "feels like" temperature in Celsius

**humidity** - relative humidity

**windspeed** - wind speed

**casual** - number of non-registered user rentals initiated

**registered** - number of registered user rentals initiated

**count** - number of total rentals


```r
library(rpart)
library(rpart.plot)
library(rattle)
library(data.table)
library(partykit)
library(RCurl)
```

### 1. Reading files


```r
url <- getURL('https://raw.githubusercontent.com/frankwwu/R-Knots/master/Bike%20Sharing/train.csv')
train <- read.csv(text = url) 
url <- getURL('https://raw.githubusercontent.com/frankwwu/R-Knots/master/Bike%20Sharing/test.csv')
test <- read.csv(text = url) 
```

### 2. Feature selection

Since temp and atemp are highly correlated, we can remove one of them from the training data. We will remove atemp in following feature set.


```r
train<-train[, !(colnames(train) %in% c('atemp'))]
time <- factor(substring(train$datetime, 12, 20))
train$hour<- as.numeric(substr(time, 1, 2))
train$month <- factor(substring(as.Date(train$datetime), 6, 7))
train$workingday <- factor(train$workingday)

test<-test[, !(colnames(test) %in% c('atemp'))] 
time <- factor(substring(test$datetime, 12, 20))
test$hour<- as.numeric(substr(time, 1, 2))
test$month <- factor(substring(as.Date(test$datetime), 6, 7))
test$workingday <- factor(test$workingday)
```


```r
formula <- count ~ month + weather + temp + humidity + hour + workingday + holiday
```

### 3. Conditional Inference Trees


```r
fit <- ctree(formula, data=train)

# Print the tree
print(fit)
```

```
## 
## Model formula:
## count ~ month + weather + temp + humidity + hour + workingday + 
##     holiday
## 
## Fitted party:
## [1] root
## |   [2] hour <= 6
## |   |   [3] month in 01, 02, 03, 04
## |   |   |   [4] temp <= 11.48
## |   |   |   |   [5] hour <= 5
## |   |   |   |   |   [6] workingday in 0
## |   |   |   |   |   |   [7] hour <= 2: 31.067 (n = 60, err = 15961.7)
## |   |   |   |   |   |   [8] hour > 2
## |   |   |   |   |   |   |   [9] hour <= 3: 14.409 (n = 22, err = 3483.3)
## |   |   |   |   |   |   |   [10] hour > 3: 4.269 (n = 52, err = 662.2)
## |   |   |   |   |   [11] workingday in 1: 6.307 (n = 277, err = 11068.9)
## |   |   |   |   [12] hour > 5
## |   |   |   |   |   [13] workingday in 0
## |   |   |   |   |   |   [14] month in 01, 03, 04: 7.882 (n = 17, err = 987.8)
## |   |   |   |   |   |   [15] month in 02: 4.600 (n = 10, err = 66.4)
## |   |   |   |   |   [16] workingday in 1: 51.618 (n = 55, err = 38367.0)
## |   |   |   [17] temp > 11.48
## |   |   |   |   [18] workingday in 0
## |   |   |   |   |   [19] hour <= 2
## |   |   |   |   |   |   [20] holiday <= 0
## |   |   |   |   |   |   |   [21] hour <= 1: 59.189 (n = 53, err = 38954.1)
## |   |   |   |   |   |   |   [22] hour > 1: 42.478 (n = 23, err = 10043.7)
## |   |   |   |   |   |   [23] holiday > 0: 22.333 (n = 9, err = 1164.0)
## |   |   |   |   |   [24] hour > 2
## |   |   |   |   |   |   [25] holiday <= 0: 12.590 (n = 83, err = 15790.1)
## |   |   |   |   |   |   [26] holiday > 0: 31.375 (n = 8, err = 13753.9)
## |   |   |   |   [27] workingday in 1
## |   |   |   |   |   [28] hour <= 5
## |   |   |   |   |   |   [29] hour <= 0
## |   |   |   |   |   |   |   [30] temp <= 15.58: 19.913 (n = 23, err = 2625.8)
## |   |   |   |   |   |   |   [31] temp > 15.58: 33.121 (n = 33, err = 6555.5)
## |   |   |   |   |   |   [32] hour > 0: 9.287 (n = 244, err = 16849.9)
## |   |   |   |   |   [33] hour > 5: 81.319 (n = 47, err = 49262.2)
## |   |   [34] month in 05, 06, 07, 08, 09, 10, 11, 12
## |   |   |   [35] workingday in 0
## |   |   |   |   [36] hour <= 2
## |   |   |   |   |   [37] hour <= 0
## |   |   |   |   |   |   [38] temp <= 21.32: 96.467 (n = 45, err = 57751.2)
## |   |   |   |   |   |   [39] temp > 21.32
## |   |   |   |   |   |   |   [40] weather <= 1: 141.632 (n = 38, err = 38252.8)
## |   |   |   |   |   |   |   [41] weather > 1: 110.615 (n = 13, err = 10305.1)
## |   |   |   |   |   [42] hour > 0
## |   |   |   |   |   |   [43] hour <= 1
## |   |   |   |   |   |   |   [44] holiday <= 0: 89.307 (n = 88, err = 62036.7)
## |   |   |   |   |   |   |   [45] holiday > 0: 58.875 (n = 8, err = 11286.9)
## |   |   |   |   |   |   [46] hour > 1
## |   |   |   |   |   |   |   [47] temp <= 20.5: 53.977 (n = 44, err = 14797.0)
## |   |   |   |   |   |   |   [48] temp > 20.5: 72.481 (n = 52, err = 17907.0)
## |   |   |   |   [49] hour > 2
## |   |   |   |   |   [50] temp <= 10.66: 10.518 (n = 56, err = 2492.0)
## |   |   |   |   |   [51] temp > 10.66
## |   |   |   |   |   |   [52] hour <= 3
## |   |   |   |   |   |   |   [53] holiday <= 0: 32.675 (n = 77, err = 8586.9)
## |   |   |   |   |   |   |   [54] holiday > 0: 16.625 (n = 8, err = 801.9)
## |   |   |   |   |   |   [55] hour > 3
## |   |   |   |   |   |   |   [56] hour <= 5: 11.457 (n = 162, err = 6572.2)
## |   |   |   |   |   |   |   [57] hour > 5: 25.148 (n = 81, err = 15986.2)
## |   |   |   [58] workingday in 1
## |   |   |   |   [59] hour <= 5
## |   |   |   |   |   [60] hour <= 0
## |   |   |   |   |   |   [61] humidity <= 74: 52.123 (n = 114, err = 112104.3)
## |   |   |   |   |   |   [62] humidity > 74
## |   |   |   |   |   |   |   [63] temp <= 14.76: 19.538 (n = 13, err = 253.2)
## |   |   |   |   |   |   |   [64] temp > 14.76: 37.704 (n = 81, err = 25818.9)
## |   |   |   |   |   [65] hour > 0
## |   |   |   |   |   |   [66] hour <= 4
## |   |   |   |   |   |   |   [67] hour <= 1
## |   |   |   |   |   |   |   |   [68] humidity <= 79: 22.163 (n = 135, err = 28822.4)
## |   |   |   |   |   |   |   |   [69] humidity > 79
## |   |   |   |   |   |   |   |   |   [70] temp <= 14.76: 9.385 (n = 13, err = 137.1)
## |   |   |   |   |   |   |   |   |   [71] temp > 14.76
## |   |   |   |   |   |   |   |   |   |   [72] weather <= 1: 18.880 (n = 25, err = 1310.6)
## |   |   |   |   |   |   |   |   |   |   [73] weather > 1: 12.794 (n = 34, err = 1095.6)
## |   |   |   |   |   |   |   [74] hour > 1
## |   |   |   |   |   |   |   |   [75] hour <= 2
## |   |   |   |   |   |   |   |   |   [76] humidity <= 78: 11.592 (n = 125, err = 9250.2)
## |   |   |   |   |   |   |   |   |   [77] humidity > 78: 7.402 (n = 82, err = 1425.7)
## |   |   |   |   |   |   |   |   [78] hour > 2
## |   |   |   |   |   |   |   |   |   [79] weather <= 2
## |   |   |   |   |   |   |   |   |   |   [80] hour <= 3: 5.814 (n = 188, err = 1786.5)
## |   |   |   |   |   |   |   |   |   |   [81] hour > 3: 6.732 (n = 190, err = 1631.3)
## |   |   |   |   |   |   |   |   |   [82] weather > 2: 4.029 (n = 35, err = 129.0)
## |   |   |   |   |   |   [83] hour > 4
## |   |   |   |   |   |   |   [84] humidity <= 94
## |   |   |   |   |   |   |   |   [85] month in 05, 11, 12
## |   |   |   |   |   |   |   |   |   [86] humidity <= 71: 31.345 (n = 29, err = 1822.6)
## |   |   |   |   |   |   |   |   |   [87] humidity > 71: 23.915 (n = 47, err = 2425.7)
## |   |   |   |   |   |   |   |   [88] month in 06, 07, 08, 09, 10: 31.960 (n = 125, err = 10974.8)
## |   |   |   |   |   |   |   [89] humidity > 94: 12.000 (n = 7, err = 334.0)
## |   |   |   |   [90] hour > 5
## |   |   |   |   |   [91] weather <= 2
## |   |   |   |   |   |   [92] temp <= 18.04: 112.896 (n = 67, err = 56300.3)
## |   |   |   |   |   |   [93] temp > 18.04: 135.383 (n = 115, err = 136175.2)
## |   |   |   |   |   [94] weather > 2: 77.115 (n = 26, err = 47194.7)
## |   [95] hour > 6
## |   |   [96] weather <= 2
## |   |   |   [97] month in 01, 02, 03
## |   |   |   |   [98] temp <= 16.4
## |   |   |   |   |   [99] temp <= 9.84
## |   |   |   |   |   |   [100] hour <= 9
## |   |   |   |   |   |   |   [101] workingday in 0
## |   |   |   |   |   |   |   |   [102] hour <= 7: 16.955 (n = 22, err = 2543.0)
## |   |   |   |   |   |   |   |   [103] hour > 7: 64.216 (n = 37, err = 58336.3)
## |   |   |   |   |   |   |   [104] workingday in 1: 203.135 (n = 133, err = 1668213.6)
## |   |   |   |   |   |   [105] hour > 9
## |   |   |   |   |   |   |   [106] humidity <= 41
## |   |   |   |   |   |   |   |   [107] temp <= 4.92: 55.200 (n = 10, err = 19093.6)
## |   |   |   |   |   |   |   |   [108] temp > 4.92
## |   |   |   |   |   |   |   |   |   [109] month in 01: 119.316 (n = 98, err = 441723.2)
## |   |   |   |   |   |   |   |   |   [110] month in 02, 03: 87.159 (n = 63, err = 96900.4)
## |   |   |   |   |   |   |   [111] humidity > 41
## |   |   |   |   |   |   |   |   [112] hour <= 20
## |   |   |   |   |   |   |   |   |   [113] workingday in 0: 101.049 (n = 41, err = 93473.9)
## |   |   |   |   |   |   |   |   |   [114] workingday in 1
## |   |   |   |   |   |   |   |   |   |   [115] hour <= 16
## |   |   |   |   |   |   |   |   |   |   |   [116] weather <= 1: 70.111 (n = 45, err = 30534.4)
## |   |   |   |   |   |   |   |   |   |   |   [117] weather > 1: 54.974 (n = 38, err = 16491.0)
## |   |   |   |   |   |   |   |   |   |   [118] hour > 16
## |   |   |   |   |   |   |   |   |   |   |   [119] hour <= 18: 151.083 (n = 12, err = 3584.9)
## |   |   |   |   |   |   |   |   |   |   |   [120] hour > 18
## |   |   |   |   |   |   |   |   |   |   |   |   [121] hour <= 19: 100.727 (n = 11, err = 860.2)
## |   |   |   |   |   |   |   |   |   |   |   |   [122] hour > 19: 74.000 (n = 16, err = 6924.0)
## |   |   |   |   |   |   |   |   [123] hour > 20
## |   |   |   |   |   |   |   |   |   [124] hour <= 22: 46.411 (n = 56, err = 21787.6)
## |   |   |   |   |   |   |   |   |   [125] hour > 22: 31.216 (n = 37, err = 11568.3)
## |   |   |   |   |   [126] temp > 9.84
## |   |   |   |   |   |   [127] hour <= 19
## |   |   |   |   |   |   |   [128] month in 01, 03
## |   |   |   |   |   |   |   |   [129] weather <= 1
## |   |   |   |   |   |   |   |   |   [130] temp <= 13.12: 154.592 (n = 130, err = 1310901.4)
## |   |   |   |   |   |   |   |   |   [131] temp > 13.12
## |   |   |   |   |   |   |   |   |   |   [132] humidity <= 46
## |   |   |   |   |   |   |   |   |   |   |   [133] workingday in 0: 311.792 (n = 24, err = 117270.0)
## |   |   |   |   |   |   |   |   |   |   |   [134] workingday in 1
## |   |   |   |   |   |   |   |   |   |   |   |   [135] hour <= 16: 127.385 (n = 26, err = 70100.2)
## |   |   |   |   |   |   |   |   |   |   |   |   [136] hour > 16: 276.125 (n = 16, err = 140061.8)
## |   |   |   |   |   |   |   |   |   |   [137] humidity > 46: 148.528 (n = 36, err = 397561.0)
## |   |   |   |   |   |   |   |   [138] weather > 1
## |   |   |   |   |   |   |   |   |   [139] workingday in 0: 74.500 (n = 24, err = 69400.0)
## |   |   |   |   |   |   |   |   |   [140] workingday in 1: 144.964 (n = 83, err = 769198.9)
## |   |   |   |   |   |   |   [141] month in 02: 188.564 (n = 211, err = 2388635.9)
## |   |   |   |   |   |   [142] hour > 19
## |   |   |   |   |   |   |   [143] hour <= 21
## |   |   |   |   |   |   |   |   [144] workingday in 0: 63.656 (n = 32, err = 25681.2)
## |   |   |   |   |   |   |   |   [145] workingday in 1
## |   |   |   |   |   |   |   |   |   [146] month in 01, 02: 146.026 (n = 38, err = 89639.0)
## |   |   |   |   |   |   |   |   |   [147] month in 03: 98.625 (n = 24, err = 35123.6)
## |   |   |   |   |   |   |   [148] hour > 21
## |   |   |   |   |   |   |   |   [149] hour <= 22: 78.020 (n = 50, err = 64213.0)
## |   |   |   |   |   |   |   |   [150] hour > 22: 48.721 (n = 43, err = 21046.7)
## |   |   |   |   [151] temp > 16.4
## |   |   |   |   |   [152] temp <= 24.6
## |   |   |   |   |   |   [153] hour <= 20
## |   |   |   |   |   |   |   [154] temp <= 18.04: 223.591 (n = 127, err = 2507836.7)
## |   |   |   |   |   |   |   [155] temp > 18.04
## |   |   |   |   |   |   |   |   [156] month in 01, 03: 299.033 (n = 152, err = 3044460.8)
## |   |   |   |   |   |   |   |   [157] month in 02
## |   |   |   |   |   |   |   |   |   [158] hour <= 16: 140.818 (n = 22, err = 65349.3)
## |   |   |   |   |   |   |   |   |   [159] hour > 16: 285.077 (n = 13, err = 199390.9)
## |   |   |   |   |   |   [160] hour > 20
## |   |   |   |   |   |   |   [161] hour <= 22
## |   |   |   |   |   |   |   |   [162] temp <= 20.5: 125.652 (n = 23, err = 38895.2)
## |   |   |   |   |   |   |   |   [163] temp > 20.5: 187.053 (n = 19, err = 54530.9)
## |   |   |   |   |   |   |   [164] hour > 22: 78.905 (n = 21, err = 26881.8)
## |   |   |   |   |   [165] temp > 24.6: 382.317 (n = 60, err = 2537861.0)
## |   |   |   [166] month in 04, 05, 06, 07, 08, 09, 10, 11, 12
## |   |   |   |   [167] humidity <= 44
## |   |   |   |   |   [168] month in 04, 07, 08, 11, 12
## |   |   |   |   |   |   [169] temp <= 19.68
## |   |   |   |   |   |   |   [170] month in 04, 12
## |   |   |   |   |   |   |   |   [171] humidity <= 35: 279.792 (n = 72, err = 1230275.9)
## |   |   |   |   |   |   |   |   [172] humidity > 35: 221.775 (n = 89, err = 1003369.5)
## |   |   |   |   |   |   |   [173] month in 11
## |   |   |   |   |   |   |   |   [174] holiday <= 0: 311.358 (n = 106, err = 1664530.4)
## |   |   |   |   |   |   |   |   [175] holiday > 0: 209.308 (n = 13, err = 42190.8)
## |   |   |   |   |   |   [176] temp > 19.68
## |   |   |   |   |   |   |   [177] hour <= 15
## |   |   |   |   |   |   |   |   [178] workingday in 0
## |   |   |   |   |   |   |   |   |   [179] month in 07: 388.389 (n = 36, err = 138934.6)
## |   |   |   |   |   |   |   |   |   [180] month in 04, 08, 11: 516.429 (n = 49, err = 748636.0)
## |   |   |   |   |   |   |   |   [181] workingday in 1
## |   |   |   |   |   |   |   |   |   [182] weather <= 1: 231.454 (n = 194, err = 1442072.1)
## |   |   |   |   |   |   |   |   |   [183] weather > 1: 293.812 (n = 16, err = 112652.4)
## |   |   |   |   |   |   |   [184] hour > 15
## |   |   |   |   |   |   |   |   [185] hour <= 19
## |   |   |   |   |   |   |   |   |   [186] workingday in 0
## |   |   |   |   |   |   |   |   |   |   [187] month in 07, 11
## |   |   |   |   |   |   |   |   |   |   |   [188] humidity <= 34: 311.778 (n = 18, err = 87253.1)
## |   |   |   |   |   |   |   |   |   |   |   [189] humidity > 34: 439.385 (n = 13, err = 103401.1)
## |   |   |   |   |   |   |   |   |   |   [190] month in 04, 08: 482.471 (n = 34, err = 503798.5)
## |   |   |   |   |   |   |   |   |   [191] workingday in 1: 522.333 (n = 144, err = 4695782.0)
## |   |   |   |   |   |   |   |   [192] hour > 19
## |   |   |   |   |   |   |   |   |   [193] hour <= 20: 301.231 (n = 26, err = 208264.6)
## |   |   |   |   |   |   |   |   |   [194] hour > 20
## |   |   |   |   |   |   |   |   |   |   [195] hour <= 21: 201.769 (n = 13, err = 59474.3)
## |   |   |   |   |   |   |   |   |   |   [196] hour > 21: 129.071 (n = 14, err = 31222.9)
## |   |   |   |   |   [197] month in 05, 06, 09, 10
## |   |   |   |   |   |   [198] workingday in 0
## |   |   |   |   |   |   |   [199] month in 09
## |   |   |   |   |   |   |   |   [200] humidity <= 39: 666.688 (n = 16, err = 75041.4)
## |   |   |   |   |   |   |   |   [201] humidity > 39: 508.167 (n = 12, err = 161149.7)
## |   |   |   |   |   |   |   [202] month in 05, 06, 10
## |   |   |   |   |   |   |   |   [203] hour <= 18: 512.628 (n = 113, err = 1404806.4)
## |   |   |   |   |   |   |   |   [204] hour > 18
## |   |   |   |   |   |   |   |   |   [205] hour <= 19: 395.800 (n = 10, err = 70377.6)
## |   |   |   |   |   |   |   |   |   [206] hour > 19: 268.818 (n = 11, err = 76089.6)
## |   |   |   |   |   |   [207] workingday in 1
## |   |   |   |   |   |   |   [208] hour <= 15
## |   |   |   |   |   |   |   |   [209] temp <= 31.16: 274.677 (n = 164, err = 1264207.9)
## |   |   |   |   |   |   |   |   [210] temp > 31.16
## |   |   |   |   |   |   |   |   |   [211] temp <= 34.44: 194.368 (n = 19, err = 39252.4)
## |   |   |   |   |   |   |   |   |   [212] temp > 34.44: 138.462 (n = 13, err = 3705.2)
## |   |   |   |   |   |   |   [213] hour > 15
## |   |   |   |   |   |   |   |   [214] hour <= 19
## |   |   |   |   |   |   |   |   |   [215] month in 09: 740.000 (n = 17, err = 640748.0)
## |   |   |   |   |   |   |   |   |   [216] month in 05, 06, 10: 561.785 (n = 107, err = 3666326.1)
## |   |   |   |   |   |   |   |   [217] hour > 19
## |   |   |   |   |   |   |   |   |   [218] hour <= 20: 356.882 (n = 17, err = 99309.8)
## |   |   |   |   |   |   |   |   |   [219] hour > 20
## |   |   |   |   |   |   |   |   |   |   [220] hour <= 21: 272.545 (n = 11, err = 36816.7)
## |   |   |   |   |   |   |   |   |   |   [221] hour > 21: 190.600 (n = 10, err = 31638.4)
## |   |   |   |   [222] humidity > 44
## |   |   |   |   |   [223] month in 04, 11, 12
## |   |   |   |   |   |   [224] hour <= 19
## |   |   |   |   |   |   |   [225] hour <= 16
## |   |   |   |   |   |   |   |   [226] month in 04
## |   |   |   |   |   |   |   |   |   [227] weather <= 1: 250.705 (n = 95, err = 2312157.7)
## |   |   |   |   |   |   |   |   |   [228] weather > 1: 180.091 (n = 99, err = 1851984.2)
## |   |   |   |   |   |   |   |   [229] month in 11, 12: 262.210 (n = 553, err = 11575511.7)
## |   |   |   |   |   |   |   [230] hour > 16
## |   |   |   |   |   |   |   |   [231] workingday in 0
## |   |   |   |   |   |   |   |   |   [232] temp <= 20.5
## |   |   |   |   |   |   |   |   |   |   [233] hour <= 17: 280.933 (n = 15, err = 124174.9)
## |   |   |   |   |   |   |   |   |   |   [234] hour > 17: 206.205 (n = 44, err = 176763.2)
## |   |   |   |   |   |   |   |   |   [235] temp > 20.5: 403.800 (n = 10, err = 235057.6)
## |   |   |   |   |   |   |   |   [236] workingday in 1
## |   |   |   |   |   |   |   |   |   [237] hour <= 18
## |   |   |   |   |   |   |   |   |   |   [238] month in 04: 378.154 (n = 13, err = 78605.7)
## |   |   |   |   |   |   |   |   |   |   [239] month in 11, 12: 491.132 (n = 76, err = 1014682.7)
## |   |   |   |   |   |   |   |   |   [240] hour > 18: 314.173 (n = 52, err = 393949.4)
## |   |   |   |   |   |   [241] hour > 19
## |   |   |   |   |   |   |   [242] hour <= 21
## |   |   |   |   |   |   |   |   [243] temp <= 18.04
## |   |   |   |   |   |   |   |   |   [244] workingday in 0
## |   |   |   |   |   |   |   |   |   |   [245] month in 11, 12
## |   |   |   |   |   |   |   |   |   |   |   [246] temp <= 12.3: 99.455 (n = 11, err = 6970.7)
## |   |   |   |   |   |   |   |   |   |   |   [247] temp > 12.3: 147.742 (n = 31, err = 48259.9)
## |   |   |   |   |   |   |   |   |   |   [248] month in 04: 82.375 (n = 8, err = 6691.9)
## |   |   |   |   |   |   |   |   |   [249] workingday in 1
## |   |   |   |   |   |   |   |   |   |   [250] hour <= 20
## |   |   |   |   |   |   |   |   |   |   |   [251] month in 04: 144.750 (n = 8, err = 41077.5)
## |   |   |   |   |   |   |   |   |   |   |   [252] month in 11, 12: 218.600 (n = 35, err = 63422.4)
## |   |   |   |   |   |   |   |   |   |   [253] hour > 20: 156.784 (n = 51, err = 94654.6)
## |   |   |   |   |   |   |   |   [254] temp > 18.04: 224.267 (n = 30, err = 150835.9)
## |   |   |   |   |   |   |   [255] hour > 21
## |   |   |   |   |   |   |   |   [256] hour <= 22
## |   |   |   |   |   |   |   |   |   [257] temp <= 19.68: 112.615 (n = 78, err = 110682.5)
## |   |   |   |   |   |   |   |   |   [258] temp > 19.68: 151.727 (n = 11, err = 29682.2)
## |   |   |   |   |   |   |   |   [259] hour > 22: 81.381 (n = 97, err = 144600.9)
## |   |   |   |   |   [260] month in 05, 06, 07, 08, 09, 10
## |   |   |   |   |   |   [261] humidity <= 73
## |   |   |   |   |   |   |   [262] temp <= 22.14
## |   |   |   |   |   |   |   |   [263] hour <= 20
## |   |   |   |   |   |   |   |   |   [264] workingday in 0
## |   |   |   |   |   |   |   |   |   |   [265] hour <= 8: 109.200 (n = 25, err = 145462.0)
## |   |   |   |   |   |   |   |   |   |   [266] hour > 8
## |   |   |   |   |   |   |   |   |   |   |   [267] holiday <= 0: 280.370 (n = 54, err = 413780.6)
## |   |   |   |   |   |   |   |   |   |   |   [268] holiday > 0: 380.889 (n = 9, err = 37496.9)
## |   |   |   |   |   |   |   |   |   [269] workingday in 1: 347.524 (n = 147, err = 4882864.7)
## |   |   |   |   |   |   |   |   [270] hour > 20
## |   |   |   |   |   |   |   |   |   [271] hour <= 21: 197.929 (n = 28, err = 91181.9)
## |   |   |   |   |   |   |   |   |   [272] hour > 21: 134.039 (n = 51, err = 94147.9)
## |   |   |   |   |   |   |   [273] temp > 22.14
## |   |   |   |   |   |   |   |   [274] month in 06, 07, 08
## |   |   |   |   |   |   |   |   |   [275] humidity <= 55
## |   |   |   |   |   |   |   |   |   |   [276] workingday in 0
## |   |   |   |   |   |   |   |   |   |   |   [277] temp <= 25.42: 271.700 (n = 10, err = 181018.1)
## |   |   |   |   |   |   |   |   |   |   |   [278] temp > 25.42: 386.580 (n = 119, err = 1235739.0)
## |   |   |   |   |   |   |   |   |   |   [279] workingday in 1: 323.003 (n = 318, err = 10257669.0)
## |   |   |   |   |   |   |   |   |   [280] humidity > 55
## |   |   |   |   |   |   |   |   |   |   [281] workingday in 0
## |   |   |   |   |   |   |   |   |   |   |   [282] humidity <= 62: 289.012 (n = 85, err = 1183509.0)
## |   |   |   |   |   |   |   |   |   |   |   [283] humidity > 62: 219.835 (n = 79, err = 1132762.9)
## |   |   |   |   |   |   |   |   |   |   [284] workingday in 1
## |   |   |   |   |   |   |   |   |   |   |   [285] hour <= 8
## |   |   |   |   |   |   |   |   |   |   |   |   [286] hour <= 7: 391.542 (n = 24, err = 217530.0)
## |   |   |   |   |   |   |   |   |   |   |   |   [287] hour > 7: 550.281 (n = 32, err = 565080.5)
## |   |   |   |   |   |   |   |   |   |   |   [288] hour > 8: 275.580 (n = 286, err = 6454887.7)
## |   |   |   |   |   |   |   |   [289] month in 05, 09, 10
## |   |   |   |   |   |   |   |   |   [290] temp <= 27.06
## |   |   |   |   |   |   |   |   |   |   [291] month in 10: 375.281 (n = 121, err = 4119058.4)
## |   |   |   |   |   |   |   |   |   |   [292] month in 05, 09: 308.438 (n = 276, err = 7001728.0)
## |   |   |   |   |   |   |   |   |   [293] temp > 27.06
## |   |   |   |   |   |   |   |   |   |   [294] hour <= 16
## |   |   |   |   |   |   |   |   |   |   |   [295] workingday in 0: 433.742 (n = 62, err = 873773.9)
## |   |   |   |   |   |   |   |   |   |   |   [296] workingday in 1
## |   |   |   |   |   |   |   |   |   |   |   |   [297] hour <= 15: 243.405 (n = 79, err = 397739.0)
## |   |   |   |   |   |   |   |   |   |   |   |   [298] hour > 15: 389.895 (n = 19, err = 132837.8)
## |   |   |   |   |   |   |   |   |   |   [299] hour > 16
## |   |   |   |   |   |   |   |   |   |   |   [300] hour <= 18
## |   |   |   |   |   |   |   |   |   |   |   |   [301] workingday in 0: 423.267 (n = 15, err = 57432.9)
## |   |   |   |   |   |   |   |   |   |   |   |   [302] workingday in 1: 701.471 (n = 34, err = 691292.5)
## |   |   |   |   |   |   |   |   |   |   |   [303] hour > 18
## |   |   |   |   |   |   |   |   |   |   |   |   [304] hour <= 19: 479.312 (n = 16, err = 167027.4)
## |   |   |   |   |   |   |   |   |   |   |   |   [305] hour > 19: 281.111 (n = 9, err = 127532.9)
## |   |   |   |   |   |   [306] humidity > 73
## |   |   |   |   |   |   |   [307] hour <= 20
## |   |   |   |   |   |   |   |   [308] workingday in 0
## |   |   |   |   |   |   |   |   |   [309] hour <= 8
## |   |   |   |   |   |   |   |   |   |   [310] hour <= 7: 55.474 (n = 38, err = 24957.5)
## |   |   |   |   |   |   |   |   |   |   [311] hour > 7: 118.931 (n = 29, err = 72905.9)
## |   |   |   |   |   |   |   |   |   [312] hour > 8
## |   |   |   |   |   |   |   |   |   |   [313] temp <= 21.32: 177.480 (n = 25, err = 92138.2)
## |   |   |   |   |   |   |   |   |   |   [314] temp > 21.32: 262.366 (n = 82, err = 546655.0)
## |   |   |   |   |   |   |   |   [315] workingday in 1
## |   |   |   |   |   |   |   |   |   [316] hour <= 8
## |   |   |   |   |   |   |   |   |   |   [317] hour <= 7: 371.385 (n = 78, err = 873192.5)
## |   |   |   |   |   |   |   |   |   |   [318] hour > 7: 554.938 (n = 65, err = 1437601.8)
## |   |   |   |   |   |   |   |   |   [319] hour > 8
## |   |   |   |   |   |   |   |   |   |   [320] hour <= 16
## |   |   |   |   |   |   |   |   |   |   |   [321] hour <= 9: 281.659 (n = 44, err = 265965.9)
## |   |   |   |   |   |   |   |   |   |   |   [322] hour > 9
## |   |   |   |   |   |   |   |   |   |   |   |   [323] humidity <= 89: 173.375 (n = 80, err = 219506.8)
## |   |   |   |   |   |   |   |   |   |   |   |   [324] humidity > 89: 65.500 (n = 10, err = 8622.5)
## |   |   |   |   |   |   |   |   |   |   [325] hour > 16
## |   |   |   |   |   |   |   |   |   |   |   [326] hour <= 18: 462.000 (n = 24, err = 676064.0)
## |   |   |   |   |   |   |   |   |   |   |   [327] hour > 18
## |   |   |   |   |   |   |   |   |   |   |   |   [328] humidity <= 79
## |   |   |   |   |   |   |   |   |   |   |   |   |   [329] hour <= 19: 402.000 (n = 7, err = 63134.0)
## |   |   |   |   |   |   |   |   |   |   |   |   |   [330] hour > 19: 291.412 (n = 17, err = 62562.1)
## |   |   |   |   |   |   |   |   |   |   |   |   [331] humidity > 79: 259.345 (n = 29, err = 218204.6)
## |   |   |   |   |   |   |   [332] hour > 20
## |   |   |   |   |   |   |   |   [333] hour <= 22
## |   |   |   |   |   |   |   |   |   [334] humidity <= 79
## |   |   |   |   |   |   |   |   |   |   [335] hour <= 21: 220.375 (n = 32, err = 76153.5)
## |   |   |   |   |   |   |   |   |   |   [336] hour > 21: 176.526 (n = 38, err = 106047.5)
## |   |   |   |   |   |   |   |   |   [337] humidity > 79
## |   |   |   |   |   |   |   |   |   |   [338] weather <= 1: 168.744 (n = 43, err = 127534.2)
## |   |   |   |   |   |   |   |   |   |   [339] weather > 1: 132.625 (n = 32, err = 68931.5)
## |   |   |   |   |   |   |   |   [340] hour > 22
## |   |   |   |   |   |   |   |   |   [341] temp <= 23.78: 88.703 (n = 37, err = 41969.7)
## |   |   |   |   |   |   |   |   |   [342] temp > 23.78: 128.275 (n = 51, err = 108528.2)
## |   |   [343] weather > 2
## |   |   |   [344] temp <= 27.88
## |   |   |   |   [345] temp <= 18.86
## |   |   |   |   |   [346] month in 01, 03: 62.337 (n = 80, err = 360001.9)
## |   |   |   |   |   [347] month in 02, 04, 05, 10, 11, 12
## |   |   |   |   |   |   [348] humidity <= 62: 236.000 (n = 23, err = 688790.0)
## |   |   |   |   |   |   [349] humidity > 62: 110.422 (n = 187, err = 1634829.6)
## |   |   |   |   [350] temp > 18.86
## |   |   |   |   |   [351] humidity <= 69: 309.258 (n = 31, err = 1321497.9)
## |   |   |   |   |   [352] humidity > 69
## |   |   |   |   |   |   [353] humidity <= 79: 204.925 (n = 40, err = 586532.8)
## |   |   |   |   |   |   [354] humidity > 79: 144.835 (n = 200, err = 2657775.6)
## |   |   |   [355] temp > 27.88: 318.517 (n = 60, err = 2247655.0)
## 
## Number of inner nodes:    177
## Number of terminal nodes: 178
```

```r
#plot(fit, type = "simple")
```

### 4. Prediction


```r
predict <- predict(fit, test)
#plot(predict, type = "simple")
#text(predict)
result <- data.frame(datetime = test$datetime, temp = test$temp, month = test$month, workingday = test$workingday, count=predict)
write.csv(result, file="ctree_result.csv", row.names=FALSE)
```

